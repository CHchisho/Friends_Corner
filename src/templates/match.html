{% extends "base.html" %}
{% block head %}    
	<meta charset="UTF-8">
<!--    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">-->
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<!--    <script type="text/javascript" src="{{ url_for('static', path='test.js') }}"></script>-->
{% endblock %}

{% block content %}

<body>

    <style>
		body{
			background-image: url("{{ url_for('static', path='images/white.jpg') }}");
			background-size: cover;
		}
        #container {
            position: relative;
			margin-top: 2%;
/*            width: 20%;*/
/*            height: 450px;*/
			width: 25vw;
			min-width: 300px;
			height: 75vh;
			min-height: 400px;
            background: url("{{ url_for('static', path='photos/' ~ userdata.id ~ '_1.jpg') }}") no-repeat center center;
            background-size: cover;
			background-color: black;
			
			border-radius: 20px;
			-webkit-box-shadow: 0px 0px 30px 0px rgba(0,0,0,0.6);
			-moz-box-shadow: 0px 0px 30px 0px rgba(0,0,0,0.6);
			box-shadow: 0px 0px 30px 0px rgba(0,0,0,0.6);
			
        }

        #userInfo {
			width: 50%;
            color: black;
			background-color: #eeeeee;
			display: flex;
			flex-direction: column;
			border-radius: 10px;
			-webkit-box-shadow: 0px 0px 30px 0px rgba(0,0,0,0.6);
			-moz-box-shadow: 0px 0px 30px 0px rgba(0,0,0,0.6);
			box-shadow: 0px 0px 30px 0px rgba(0,0,0,0.4);
			padding: 2%;
        }
		p {
			margin-bottom: 10px;
			font-size: 1.05rem;
/*			color: #5065FF;*/
		    font-weight: bold;
		}
		

        #buttonsContainer {
            position: absolute;
            bottom: 0px;
/*            left: 20px;*/
			width: 100%;
			height: 20%;
            display: flex;
			justify-content: space-around;
			align-items: flex-end;
        }

        .button {
            width: 24%;
            height: 80%;
/*            margin-right: 10px;*/
            cursor: pointer;
			display: flex;
			justify-content: center;
			align-items: center;
			font-size: 2.5rem;
			border-radius: 10px;
			transition: transform 0.5s ease;
			user-select: none;
        }
		.button:hover {
/*			background-color: #4477FF;*/
			transform: translateY(-5px);
/*            width: 25%;*/
            height: 80%;
		}
        .buttonarrow, .buttonarrow2 {
            cursor: pointer;
			display: flex;
			justify-content: center;
			align-items: center;
			font-size: 2rem;
			border-radius: 10px;
			transition: transform 0.5s ease;
			margin: 10px;
			font-size: 60px;
			color: black;
			-webkit-text-stroke: 2px #eeeeee;
			text-stroke: 2px #eeeeee; 
			user-select: none;
			
        }
		.buttonarrow:hover {transform: translateX(-7px);}
		.buttonarrow2:hover {transform: translateX(7px);}

        #likeButton {
            background-color: lightgreen;
			padding-bottom: 10px;
        }

        #dislikeButton {
            background-color: lightpink;
        }
		
		.label_1 {
			font-size: 2.5em;
			font-weight: bold;
			font-style: normal;
		}		
		.label_2 {
			font-size: 2em;
			font-style: normal;
			font-weight: bold;
		}
@media (max-width: 600px) {
#userInfo {
margin-top: 30px;
width: 80%;}
#container{margin-top: 20%;}
}
    </style>

	
<div>
	<div style="

	display: flex;
	flex-direction: row;
	justify-content: center;
	align-items: center;
	justify-content: space-around;
	margin-top: 3%;
	flex-wrap: wrap;
	"> 
		

		<div id="container">
			
			<div style="height: 100%; width: 100%; position: absolute; display:flex; justify-content: space-between;">
				<div class="buttonarrow" onclick="select_image(1)">‚ùÆ</div>
				<div class="buttonarrow2" onclick="select_image(2)">‚ùØ</div>
			</div>
			
			<div id="buttonsContainer">
				<div id="likeButton" class="button" onclick="send_answer_match(1)">üëç</div>
<!--				<div id="downButton" class="button" >‚¨á</div>-->
				<div id="dislikeButton" class="button" onclick="send_answer_match(2)">üëé</div>
			</div>
		</div>
		
		<div id="userInfo">
			<label class="label_1">About Me</label>
			<p id="name" class="label_2">Name</p> 
<!--
			<div style="display: flex; flex-direction: row;"> 
				<p id="age" class="label_2">18</p> 
			</div>
-->
			
			<p id="region"></p>
			<p id="hobbies"></p>
<!--			<p id="id" style="color:rgba(0,0,0,0.00);">10</p>-->
			<p id="info"></p>
		</div>
		
	</div>
	
	<div>
		
	</div>
</div>
	
<!--	<br><br><br><br><br><br>-->
	 
	
	
	



<script>
	
	var client_name='{{ userdata.username }}';
	var client_age={{ userdata.age }}; 
	var client_id={{ userdata.id }};
	var friend_id = 1;
	
	var request = 0;
	let matchArray = [];
//	var user_id_recipient = 1;
	
//	document.getElementById('name').textContent = client_name;
//	document.getElementById('age').textContent = client_age;
//	document.getElementById('id').textContent = client_id;
	
	function get_new_match(){
//		clearContainer()
//		user_id_recipient = id;
//		console.log('Selected ID: ', user_id_recipient);
		axios.get('/chat/match/'+client_id, {
		  headers: { 'Accept': 'application/json' }
		})
		.then(messages => {
			console.log(messages.data);
			matchArray = messages.data;
			
			if (matchArray.length > 0) {update_info(0);}
			else {no_anymore();}
			
		})
		.catch(error => {console.error(error);});
	}
	get_new_match();


//function submitForm() {
//	try {
//		axios.post('/chat/match'+client_id,
//		{
//			email: document.getElementById('email').value,
//			password: document.getElementById('password').value,
//		}, {headers: { 'Accept': 'application/json' }})
////		.then(res => {
////			console.log(res.data);
////		})
//		.catch(err => {console.log(err);});
//	}
//	catch (error) {console.error(error);}}
	
function send_answer_match(answer_) {
	try {
		axios.post('/chat/match/',
		{
			id_sender: client_id,
			id_recipient: friend_id,
			answer: answer_,
		}, {headers: { 'Accept': 'application/json' }})
		.then(res => {
//			console.log(res.data);
			
			console.log('get answer from post');
			console.log(request);
			
			if (request<4){
		//		1
				if (request+2 > matchArray.length  && matchArray.length < 5){no_anymore();return;}
				
				request++;
				update_info(request);
			}
			else {
				get_new_match();
				console.log('get_new_match start')
				request=0;
			}
			
			
		})
		.catch(err => {console.log(err);});
	}
	catch (error) {console.error(error);}	
//	alert('Button clicked: ' + answer_);
//	alert('New user:');
}

	
// –û–±–Ω–æ–≤–ª—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —á–µ–ª–æ–≤–µ–∫–µ –≤ –ø—Ä–∞–≤–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
function update_info(id_){
	try {
	friend_id = matchArray[id_].id;
	document.getElementById('name').textContent = matchArray[id_].username+', '+matchArray[id_].your_age + ', '+matchArray[id_].gender;
//	document.getElementById('age').textContent = matchArray[id_].your_age;
//	document.getElementById('id').textContent = matchArray[id_].id;
//	document.getElementById('id').textContent = '';
//	document.getElementById('region').textContent = "I'm from: " + matchArray[id_].regions.charAt(0).toUpperCase() + matchArray[id_].regions.slice(1);
	document.getElementById('region').textContent = "I'm from: " + matchArray[id_].regions;
	document.getElementById('hobbies').textContent = "My hobbies: " + matchArray[id_].hobbies.split('&').join(', ');
	document.getElementById('info').textContent = "More about me: " + matchArray[id_].about_you;

	let imagePath = matchArray[id_].id + '_1.jpg';
	document.getElementById('container').style.backgroundImage = 'url("{{ url_for('static', path='photos/') }}' + imagePath + '")';
	}
	catch (error) {console.error(error);}
}
	

// –°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç, –∫–æ–≥–¥–∞ –Ω–µ—Ç –±–æ–ª—å—à–µ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
function no_anymore(){
	document.getElementById('name').textContent = 'Sorry, there are no suitable candidates yet.';
//	document.getElementById('age').textContent = '';
//	document.getElementById('id').textContent = '';
	document.getElementById('info').textContent = '';
	document.getElementById('hobbies').textContent = '';
	
	document.getElementById('region').textContent = '';

	let imagePath = 'nobody.jpg';
	document.getElementById('container').style.backgroundImage = 'url("{{ url_for('static', path='photos/') }}' + imagePath + '")';
}
	
	
// –ü–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —á–µ–ª–æ–≤–µ–∫–∞
let image_number=1;
function select_image() {
	document.getElementById('container').style.backgroundImage = 'url("{{ url_for('static', path='photos/') }}' + matchArray[request].id + '_'+image_number+'.jpg' + '")';
	image_number = (image_number === 1) ? 2 : 1;
}
	
//function createElements(sender, recipient, msg, date) {
//	var container = document.getElementById('container');
//	var messageDiv = document.createElement('div');
//	var dateBlock = document.createElement('div');
//	dateBlock.textContent = date;
//
//	var p = document.createElement('p');
//	if (sender==client_id) {
//		p.innerHTML = msg;
//		p.classList.add('odd');
//		dateBlock.classList.add('dateBlock_odd');
//	} else {
//		p.textContent = msg;
//		p.classList.add('even');
//		dateBlock.classList.add('dateBlock_even');
//	}
//	messageDiv.appendChild(p);
//	messageDiv.appendChild(dateBlock);
//	container.appendChild(messageDiv);
//}
	
//	function clearContainer() {
//		var container = document.getElementById('container');
//		container.innerHTML = ''; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
//	}
	
//    function appendMessage(msg) {
//        let messages = document.getElementById('messages')
//        let message = document.createElement('li')
//        let content = document.createTextNode(msg)
//        message.appendChild(content)
//        messages.appendChild(message)
//    }


</script>

{% endblock %}